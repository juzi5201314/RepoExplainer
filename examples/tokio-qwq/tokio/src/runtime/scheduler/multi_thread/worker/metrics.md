# 文件说明：`metrics.rs`

## 目的  
该文件定义了 Tokio 运行时多线程调度器中与工作线程（worker）相关的**指标获取方法**。通过暴露队列深度等内部状态信息，为运行时的性能监控、负载均衡和调试提供数据支持。

---

## 核心组件  

### 1. `Shared` 结构体的扩展  
通过 `impl Shared` 为 `Shared` 类型添加了以下方法：

#### (1) `injection_queue_depth()`  
- **功能**：返回全局注入队列（`inject`）的当前长度。  
- **实现**：直接通过 `self.inject.len()` 获取队列长度。  
- **作用**：用于监控外部任务注入到调度器的队列状态，反映系统整体任务负载。

#### (2) `worker_local_queue_depth(worker: usize)`  
- **功能**：返回指定工作线程本地窃取队列（`steal`）的长度。  
- **条件编译**：通过 `cfg_unstable_metrics!` 宏包裹，仅在启用 `unstable_metrics` 特性时生效。  
- **实现**：通过 `self.remotes[worker].steal.len()` 获取目标工作线程的队列长度。  
- **作用**：提供细粒度的线程级队列监控能力，支持分析任务分布和负载均衡效果。

---

## 与项目的关系  
该文件是 Tokio 运行时调度器模块的重要组成部分，具体作用如下：  
1. **指标暴露**：为调度器的内部队列状态提供可查询接口，便于运行时内部或外部工具（如性能分析器）获取关键指标。  
2. **功能分层**：通过条件编译（`cfg_unstable_metrics`），将实验性指标（如 `worker_local_queue_depth`）与核心功能分离，确保稳定性。  
3. **模块协作**：`Shared` 结构体通常作为多线程调度器的共享状态，这些方法被上层组件（如 `Worker` 或 `Runtime`）调用，用于决策任务分配或健康检查。

---

## 文件在项目中的角色  