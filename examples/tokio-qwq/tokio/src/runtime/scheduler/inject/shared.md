### 代码文件解释：`tokio/src/runtime/scheduler/inject/shared.rs`

#### **文件目的**
该文件定义了一个用于任务调度的共享队列结构 `Shared<T>`，用于 Tokio 运行时中多线程任务的高效注入和管理。通过原子操作和无锁设计，减少线程竞争，提升任务调度的性能。

---

#### **关键组件**

1. **结构体 `Shared<T>`**
   - **`len`**：使用 `AtomicUsize` 原子类型记录队列中任务的数量，避免频繁加锁。
   - **`PhantomData<T>`**：确保类型参数 `T` 的存在性约束，防止编译器优化错误。

   ```rust
   pub(crate) struct Shared<T: 'static> {
       pub(super) len: AtomicUsize,
       _p: PhantomData<T>,
   }
   ```

2. **安全标注**
   - `unsafe impl Send/Sync`：声明 `Shared<T>` 是线程安全的，允许跨线程共享。

3. **方法**
   - **`new()`**：初始化 `Shared` 和 `Synced`（队列的同步状态结构），返回元组。
   - **`push()`**：将任务安全地追加到队列末尾，需 `unsafe` 操作指针。
   - **`pop()`/`pop_n()`**：从队列头部弹出任务，支持批量操作，返回迭代器 `Pop`。
   - **`close()`**：标记队列为关闭状态，阻止后续任务注入。
   - **`is_empty()`**：检查队列是否为空。

---

#### **实现细节**
- **原子操作**：通过 `AtomicUsize` 和内存序（`Acquire`/`Release`）保证线程间可见性与一致性。
- **无锁设计**：`push` 和 `pop` 操作通过指针操作和原子更新，减少锁竞争。
- **队列结构**：依赖 `Synced` 结构（未完全展示）维护队列头尾指针，与 `Shared` 协作实现 FIFO 队列。

---

#### **与项目的关系**
该文件是 Tokio 多线程调度器的核心组件之一，负责任务队列的共享状态管理和高效操作。通过原子操作和无锁设计，确保多线程环境下任务注入和分发的高性能与线程安全，是 Tokio 异步运行时调度机制的重要基础。
