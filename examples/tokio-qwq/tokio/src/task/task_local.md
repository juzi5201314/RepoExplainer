### 文件目的
该文件实现了 Tokio 异步运行时中的任务本地存储（Task Local Storage）机制，允许在异步任务执行期间安全地绑定和访问与任务关联的本地数据。通过 `task_local!` 宏声明的静态变量，可以为每个异步任务提供独立的数据存储，解决了传统线程本地存储（TLS）在异步任务迁移时的局限性。

---

### 核心组件

#### 1. `task_local!` 宏
- **功能**：声明任务本地键（`LocalKey`），语法与标准库的 `thread_local!` 类似，但作用域绑定到异步任务而非线程。
- **实现**：
  - 使用 `thread_local!` 创建底层存储（`RefCell<Option<T>>`）。
  - 将静态变量包装为 `LocalKey` 结构体，确保数据与任务生命周期绑定。
- **示例**：
  ```rust
  task_local! {
      pub static USER_ID: String;
  }
  ```

#### 2. `LocalKey<T>` 结构体
- **功能**：任务本地键的主体，管理数据的存储和作用域。
- **关键方法**：
  - `scope(value, future)`：创建包裹异步任务的 `TaskLocalFuture`，在任务执行期间设置本地值。
  - `sync_scope(value, closure)`：同步执行闭包，设置本地值并确保作用域结束后恢复。
  - `with/try_with`：安全访问当前任务的本地值，支持 panic 或返回错误。

#### 3. `TaskLocalFuture<T, F>` Future
- **功能**：在异步任务执行期间临时绑定本地值的 Future。
- **实现细节**：
  - 使用 `pin_project` 管理内部状态（`slot` 存储值，`future` 存储任务）。
  - `poll` 方法中通过 `scope_inner` 设置本地值，执行任务后恢复。
  - `Drop` 实现确保任务结束后正确清理本地值。
- **生命周期**：
  - 本地值在 Future 执行期间有效，任务完成后自动恢复原值。

#### 4. 错误处理
- `AccessError`：当尝试访问未设置的本地值时返回。
- `ScopeInnerErr`：处理作用域嵌套或线程本地存储失效等内部错误。

---

### 工作原理
1. **声明本地键**：通过 `task_local!` 宏创建 `LocalKey`，底层使用 `thread_local` 存储数据。
2. **绑定值到任务**：调用 `scope` 或 `sync_scope` 方法时，将值临时绑定到当前任务。
3. **异步执行**：`TaskLocalFuture` 在 `poll` 过程中设置本地值，执行任务后恢复原值。
4. **数据隔离**：每个任务的本地值独立，即使任务在不同线程间迁移，数据仍与任务绑定。

---

### 在项目中的角色
该文件为 Tokio 提供了任务级别的本地存储机制，确保异步任务在执行期间能够安全、高效地访问与任务关联的上下文数据，解决了传统线程本地存储在异步编程中的局限性，是 Tokio 异步任务管理的核心组件之一。
