### 文件作用
该文件是 Tokio 异步运行时中用于实现**协作式调度（Cooperative Scheduling）**的核心模块。其主要目的是通过预算机制（Budget）控制任务的执行时间，防止长时间运行的任务独占执行器资源，从而避免任务饥饿问题。

---

### 核心组件与功能

#### 1. **预算管理（Budget）**
- **Budget 结构体**：  
  表示任务的执行预算，初始值为 `128`（可通过 `Budget::initial()` 获取）。当预算耗尽时，任务必须让出控制权。  
  - `unconstrained()` 方法返回无限制的预算，用于绕过协作调度。
  - `has_remaining()` 方法检查预算是否剩余。

- **预算作用域管理**：  
  - `budget(f)`：在给定闭包中使用初始预算执行代码，结束后恢复原预算。
  - `with_unconstrained(f)`：在无限制预算下执行闭包，结束后恢复原预算。

#### 2. **协作调度核心逻辑**
- **`poll_proceed` 函数**：  
  在轮询未来（Future）前调用，检查当前任务的预算：  
  - 若预算充足，消耗 1 单位预算并返回 `Poll::Ready`。
  - 若预算耗尽，标记任务需要让出执行权并返回 `Poll::Pending`。

- **`Coop` 包装器 Future**：  
  自动为任意 Future 添加协作调度逻辑：  
  - 轮询时先检查预算（通过 `poll_proceed`）。
  - 若预算不足，直接返回 `Pending`，强制任务让出控制权。
  - 若 Future 完成，则标记进度（`made_progress`）避免预算过度消耗。

#### 3. **无约束模式（Unconstrained）**
- **`unconstrained` 函数**：  
  允许显式绕过协作调度，适用于需要连续执行的场景（如高优先级任务）。  
  示例：  
  ```rust
  task::coop::unconstrained(fut).await;
  ```

#### 4. **预算状态检查**
- **`has_budget_remaining` 函数**：  
  返回当前任务是否仍有预算剩余，用于未来逻辑中的条件判断。

---

### 关键机制说明
1. **预算消耗逻辑**：  
   每次调用 `poll_proceed` 会消耗 1 单位预算。当预算归零时，任务必须让出执行权，由调度器重新安排。

2. **自动恢复机制**：  
   使用 `ResetGuard` 确保预算作用域结束后恢复原始值，避免状态污染。

3. **进度标记**：  
   若任务在预算耗尽前完成（如成功轮询到结果），调用 `made_progress()` 可避免预算被完全消耗，允许后续继续执行。

---

### 在项目中的角色
该文件是 Tokio 协作式调度的核心实现，通过预算机制确保任务公平性。它为异步任务提供了可选的协作式让步策略，防止单个任务长时间独占执行器资源，从而保障系统整体的响应性和资源利用率。其功能被广泛用于 Tokio 的 Futures 和任务调度中，是维持异步运行时高效稳定的关键组件。
