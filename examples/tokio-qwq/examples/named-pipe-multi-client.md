# 文件说明：`named-pipe-multi-client.rs`

## **目的**  
该文件是一个基于 Tokio 的异步编程示例，演示如何在 Windows 系统上通过命名管道（Named Pipe）实现多客户端通信。服务器端能够同时处理多个客户端的请求，客户端发送 `ping` 消息后，服务器返回 `pong` 响应。

---

## **关键组件与流程**

### **1. 服务器端实现**
- **命名管道创建**  
  使用 `ServerOptions` 创建名为 `\\.\pipe\named-pipe-multi-client` 的管道，并设置 `first_pipe_instance(true)` 确保当前实例是第一个启动的服务器，避免与其他实例冲突。
  
- **连接与任务处理**  
  - 通过 `connect().await` 等待客户端连接。
  - 每次连接后，立即将当前管道实例传递给异步任务处理（读取 `ping`、写入 `pong`）。
  - 在任务启动前，预先创建新的服务器实例，确保管道保持可用状态，避免客户端因管道关闭而报错 `NotFound`。

### **2. 客户端实现**
- **连接重试机制**  
  使用循环尝试连接管道：
  - 若管道忙（`ERROR_PIPE_BUSY`），短暂休眠后重试。
  - 其他错误直接终止。
  
- **消息交互**  
  客户端发送 `ping`，读取服务器返回的 `pong`，并通过 `assert_eq!` 验证响应正确性。

### **3. 并发管理**
- **异步任务调度**  
  服务器和客户端均通过 `tokio::spawn` 创建独立任务，实现非阻塞的异步通信。
- **多客户端支持**  
  启动 `N=10` 个客户端任务，验证服务器能同时处理多个连接请求。

---

## **错误处理**
- **服务器端**  
  检查管道创建和连接的 `io::Result`，确保资源正确打开。
- **客户端**  
  处理连接失败的特定错误码（如 `ERROR_PIPE_BUSY`），实现优雅重试。

---

## **项目中的角色**  